{
  "routes": {
    "type": "object",
    "minProperties": 1,
    "patternProperties": {
      "^[^%\\${}]+$": { "$ref": "#/ruleSchema" }
    }
  },
  "rule": {
    "title": "Rule",
    "type": "object",
    "required": ["matchers", "output"],
    "additionalProperties": false,
    "properties": {
      "matchers": { "$ref": "#/definitions/matchers" },
      "output": { "$ref": "#/definitions/output" }
    }
  },
  "matchers": {
    "type": "object",
    "minProperties": 1,
    "additionalProperties": false,
    "patternProperties": {
      "^[^%\\${}]+$": { "$ref": "#/definitions/flatValueArr" }
    }
  },
  "output": {
    "type": "object",
    "oneOf": [
      { "$ref": "#/definitions/metricsOutput" },
      { "$ref": "#/definitions/alertOutput" },
      { "$ref": "#/definitions/analyticsOutput" },
      { "$ref": "#/definitions/notificationOutput" }
    ]
  },
  "metricsOutput": {
    "title": "Metrics Output",
    "type": "object",
    "additionalProperties": false,
    "required": ["type", "series", "dimensions"],
    "properties": {
      "type": {
        "type": "string",
        "pattern": "^metrics$"
      },
      "series": { "$ref": "#/definitions/substValue" },
      "dimensions": { "$ref": "#/definitions/flatValueArr" }
    }
  },
  "alertOutput": {
    "type": "object",
    "additionalProperties": false,
    "required": ["type", "series", "dimensions", "stat_type"],
    "properties": {
      "type": {
        "type": "string",
        "pattern": "^alert$"
      },
      "series": { "$ref": "#/definitions/substValue" },
      "dimensions": { "$ref": "#/definitions/flatValueArr" },
      "stat_type": {
        "type": "string",
        "enum": ["counter", "gauge"]
      }
    }
  },
  "analyticsOutput": {
    "type": "object",
    "additionalProperties": false,
    "required": ["type", "series"],
    "properties": {
      "type": {
        "type": "string",
        "pattern": "^analytics$"
      },
      "series": { "$ref": "#/definitions/substValue" }
    }
  },
  "notificationOutput": {
    "type": "object",
    "additionalProperties": false,
    "required": ["type", "channel", "icon", "message", "user"],
    "properties": {
      "type": {
        "type": "string",
        "pattern": "^notification$"
      },
      "channel": { "$ref": "#/definitions/substValue" },
      "icon": { "$ref": "#/definitions/substValue" },
      "message": { "$ref": "#/definitions/kvSubstValue" },
      "user": { "$ref": "#/definitions/substValue" }
    }
  },
  "flatValue": {
    "type": "string",
    "pattern": "^[^%\\${}]+$"
  },
  "flatValueArr": {
    "type": "array",
    "minItems": 1,
    "uniqueItems": true,
    "items": { "$ref": "#/definitions/flatValue" }
  },
  "substValue": {
    "type": "string",
    "pattern": "^([^\\$%{}]|\\${[^%\\${}]+})+$"
  },
  "kvSubstValue": {
    "type": "string",
    "pattern": "^([^\\$%{}]|\\${[^%\\${}]+}|%{[^%\\${}]+})+$"
  }
}
